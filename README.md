### Пояснительная записка к проекту MQTT издателя и подписчика
![](https://github.com/f0lp1x/lab7/blob/master/6rr1YZFPJ2Y.jpg)
#### **Цель проекта**
Цель проекта — реализация MQTT-приложений для издателя и подписчика, которые обеспечивают возможность:
- Отправлять сообщения в разных форматах.
- Принимать и корректно декодировать входящие сообщения.

Для этого были внесены изменения в код издателя, подписчика и логики публикации сообщений.

---
Код, который вы предоставили, представляет собой два отдельных приложения на C#, использующих библиотеку **MQTTnet** для реализации функционала публикации и подписки на сообщения через протокол MQTT. Давайте разберем его по частям.

## Приложение издателя (Publisher)

### Основные компоненты

1. **Импорт библиотек**: Код начинается с импорта необходимых пространств имен, включая библиотеки для работы с кэшированием, конфигурацией и логированием.

2. **Класс Program**: Основной класс, содержащий статический метод `Main`, который является точкой входа в программу.

3. **Инициализация сервисов**:
   - Создается коллекция сервисов `ServiceCollection`, которая используется для настройки зависимостей.
   - Добавляются кэш и логирование с использованием консольного вывода.

4. **Конфигурация**:
   - Метод `InitConfiguration` загружает настройки из файла `appsettings.json`.
   - Получаются параметры подключения к MQTT из конфигурации.

5. **Публикация сообщений**:
   - Метод `StartPublishAsync` запрашивает у пользователя ввод сообщений и отправляет их на заданную тему через объект `mqttSender`.

### Важные методы

- **`Main`**:
  - Создает экземпляр `ServiceProvider`, извлекает кэш и конфигурацию.
  - Создает объект `Mqtt` для отправки сообщений и запускает процесс публикации.

- **`StartPublishAsync`**:
  - Цикл, который принимает сообщения от пользователя и отправляет их через MQTT.

## Приложение подписчика (Subscriber)

### Основные компоненты

1. **Импорт библиотек**: Аналогично приложению издателя, используются те же пространства имен для работы с кэшированием и логированием.

2. **Класс Program**: Содержит метод `Main`, который также является точкой входа.

3. **Инициализация сервисов**:
   - Создается коллекция сервисов аналогично издателю.
   - Загружается конфигурация и создается объект `Mqtt`.

4. **Подписка на сообщения**:
   - Метод `SubscribeAsync` подписывает на заданную тему с использованием уровня качества обслуживания (QoS).
   - Обработчик сообщений (`Handler`) обрабатывает полученные сообщения, пытаясь десериализовать их как JSON или выводя текстовое сообщение в случае ошибки.

### Важные методы

- **`Main`**:
  - Настраивает зависимости и создает объект для обработки MQTT.
  - Подписывается на сообщения и ожидает их получения.

- **`Handler`**:
  - Обрабатывает входящие сообщения, выводя информацию в лог о полученных данных, независимо от формата (JSON или текст).

## Заключение

Оба приложения используют подход внедрения зависимостей для управления жизненным циклом объектов и конфигурацией. Издатель отправляет сообщения на заданную тему, а подписчик получает эти сообщения и обрабатывает их. Это типичный пример использования MQTT для обмена сообщениями между клиентами в распределенных системах, таких как IoT (Интернет вещей).

![](https://github.com/sorrymorning/MQTTLAB/blob/testCoding/%D0%A1%D0%BD%D0%B8%D0%BC%D0%BE%D0%BA%20%D1%8D%D0%BA%D1%80%D0%B0%D0%BD%D0%B0%202024-12-07%20003407.png)

